<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaksMate - Pembagian Tugas Tim</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', serif;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            min-height: 100vh;
        }

        .app-name {
            font-family: 'Cinzel', serif;
            font-weight: 700;
            color: #2e7d32;
        }

        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&display=swap');

        /* Loading Animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.3s;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #c8e6c9;
            border-top: 4px solid #2e7d32;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Auth Pages */
        .auth-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .auth-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(46, 125, 50, 0.1);
            padding: 40px;
            max-width: 450px;
            width: 100%;
            animation: fadeInUp 0.5s;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-card h2 {
            color: #2e7d32;
            margin-bottom: 30px;
        }

        .btn-primary {
            background: #2e7d32;
            border: none;
            padding: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background: #1b5e20;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 125, 50, 0.3);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 20px 0;
            z-index: 1000;
            transition: all 0.3s;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 2px solid #e8f5e9;
            margin-bottom: 20px;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
        }

        .sidebar-menu li {
            margin: 5px 0;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: #333;
            text-decoration: none;
            transition: all 0.3s;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }

        .sidebar-menu i {
            margin-right: 15px;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            padding: 30px;
            min-height: 100vh;
        }

        .content-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .page-header {
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e8f5e9;
        }

        .page-header h3 {
            color: #2e7d32;
            font-weight: 600;
        }

        /* Tables */
        .table {
            font-family: 'Times New Roman', serif;
        }

        .table thead {
            background: #2e7d32;
            color: white;
        }

        /* Buttons */
        .btn-success {
            background: #2e7d32;
            border: none;
        }

        .btn-success:hover {
            background: #1b5e20;
        }

        .btn-danger {
            background: #c62828;
            border: none;
        }

        /* Chat Section */
        .chat-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            background: #f5f5f5;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .message.public {
            background: #e8f5e9;
            border-left: 4px solid #2e7d32;
        }

        .message.private {
            background: #fff3e0;
            border-left: 4px solid #f57c00;
        }

        .message-header {
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 5px;
        }

        .message-time {
            font-size: 0.8em;
            color: #666;
        }

        /* Badge */
        .skill-badge {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            background: #e8f5e9;
            color: #2e7d32;
            border-radius: 15px;
            font-size: 0.9em;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-btn {
                display: block !important;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1001;
                background: #2e7d32;
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 5px;
            }
        }

        .mobile-menu-btn {
            display: none;
        }

        /* Task Assignment Card */
        .assignment-card {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-left: 5px solid #2e7d32;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .assignment-card h5 {
            color: #2e7d32;
            font-weight: 600;
        }

        /* Archive Styles */
        .archive-item {
            background: #f8f9fa;
            border-left: 4px solid #6c757d;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .archive-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .archive-item.overdue {
            border-left-color: #dc3545;
        }

        .archive-item.completed {
            border-left-color: #28a745;
        }

        .archive-badge {
            font-size: 0.8em;
            padding: 3px 8px;
            border-radius: 10px;
        }

        .empty-archive {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .archive-stats {
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        /* Status Badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-in-progress {
            background-color: #cce5ff;
            color: #004085;
        }

        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }

        /* Priority Badges */
        .priority-low {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        .priority-medium {
            background-color: #fff3cd;
            color: #856404;
        }

        .priority-high {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Activity History Styles */
        .activity-timeline {
            position: relative;
            padding-left: 30px;
            margin-top: 20px;
        }
        
        .activity-timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e0e0e0;
        }
        
        .activity-item {
            position: relative;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid #2e7d32;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            animation: slideInRight 0.3s;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .activity-item::before {
            content: '';
            position: absolute;
            left: -23px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #2e7d32;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #2e7d32;
        }
        
        .activity-item.system {
            border-left-color: #2196f3;
        }
        
        .activity-item.system::before {
            background: #2196f3;
            box-shadow: 0 0 0 2px #2196f3;
        }
        
        .activity-item.warning {
            border-left-color: #ff9800;
        }
        
        .activity-item.warning::before {
            background: #ff9800;
            box-shadow: 0 0 0 2px #ff9800;
        }
        
        .activity-item.danger {
            border-left-color: #f44336;
        }
        
        .activity-item.danger::before {
            background: #f44336;
            box-shadow: 0 0 0 2px #f44336;
        }
        
        .activity-item.success {
            border-left-color: #4caf50;
        }
        
        .activity-item.success::before {
            background: #4caf50;
            box-shadow: 0 0 0 2px #4caf50;
        }
        
        .activity-icon {
            font-size: 1.2em;
            margin-right: 10px;
            width: 30px;
            text-align: center;
        }
        
        .activity-time {
            font-size: 0.85em;
            color: #666;
            margin-left: 10px;
        }
        
        .activity-user {
            font-weight: 600;
            color: #2e7d32;
        }
        
        .activity-content {
            margin-top: 5px;
            color: #333;
        }
        
        .activity-details {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            padding-left: 20px;
        }
        
        .activity-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        
        .activity-filter {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .activity-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat-card i {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .stat-card h4 {
            margin: 0;
            font-size: 1.5em;
        }
        
        .stat-card p {
            margin: 5px 0 0;
            color: #666;
            font-size: 0.9em;
        }

        /* =============== ADMIN STYLES =============== */
        .admin-badge {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .delete-modal .modal-content {
            border: 3px solid #dc3545;
        }

        .delete-modal .modal-header {
            background: #dc3545;
            color: white;
            border-radius: 10px 10px 0 0;
        }

        .user-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        .user-status.online {
            background-color: #28a745;
        }

        .user-status.offline {
            background-color: #6c757d;
        }

        .user-status.away {
            background-color: #ffc107;
        }

        .admin-table th {
            background: #2e7d32;
            color: white;
            position: sticky;
            top: 0;
        }

        .admin-table td {
            vertical-align: middle;
        }

        .permission-badge {
            font-size: 0.75em;
            padding: 2px 8px;
            border-radius: 10px;
            margin-right: 3px;
        }

        .permission-admin {
            background-color: #dc3545;
            color: white;
        }

        .permission-editor {
            background-color: #007bff;
            color: white;
        }

        .permission-viewer {
            background-color: #6c757d;
            color: white;
        }

        .last-activity {
            font-size: 0.85em;
            color: #6c757d;
        }

        #adminMenuButton {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white !important;
            margin: 5px 20px;
            border-radius: 10px;
        }

        #adminMenuButton:hover {
            background: linear-gradient(135deg, #c82333 0%, #b21f2d 100%);
            transform: translateY(-2px);
        }

        .stat-card-small {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        .stat-card-small i {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .stat-card-small h4 {
            margin: 0;
            font-size: 1.3em;
        }

        .stat-card-small p {
            margin: 5px 0 0;
            color: #666;
            font-size: 0.85em;
        }

        /* =============== MULTI DEVICE STYLES =============== */
        .device-badge {
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 8px;
            margin-left: 5px;
        }

        .device-desktop {
            background-color: #007bff;
            color: white;
        }

        .device-mobile {
            background-color: #28a745;
            color: white;
        }

        .device-tablet {
            background-color: #ffc107;
            color: black;
        }

        .device-unknown {
            background-color: #6c757d;
            color: white;
        }

        .session-item {
            background: #f8f9fa;
            border-left: 4px solid #2e7d32;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .session-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .session-item.current {
            border-left-color: #007bff;
            background: #e7f3ff;
        }

        .session-item.expired {
            border-left-color: #6c757d;
            background: #f8f9fa;
            opacity: 0.7;
        }

        .session-item.expired .session-status {
            color: #6c757d;
        }

        .device-icon {
            font-size: 1.2em;
            margin-right: 10px;
            width: 24px;
            text-align: center;
        }

        .session-status {
            font-size: 0.8em;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .session-active {
            background-color: #28a745;
            color: white;
        }

        .session-expired {
            background-color: #6c757d;
            color: white;
        }

        .multi-device-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .multi-device-info h6 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .device-limit-badge {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Auth Container (Login/Register) -->
    <div id="authContainer" style="display: none;">
        <!-- Login Form -->
        <div id="loginForm" class="auth-container">
            <div class="auth-card">
                <div class="text-center mb-4">
                    <i class="fas fa-users-cog fa-3x text-success mb-3"></i>
                    <h2 class="app-name">TaksMate</h2>
                    <p class="text-muted">Kelola Tim dengan Lebih Efisien</p>
                    <div class="multi-device-info">
                        <h6><i class="fas fa-laptop-house me-2"></i>Multi-Device Ready</h6>
                        <p class="mb-1"><small>Login dari 5 device berbeda secara bersamaan</small></p>
                        <span class="device-limit-badge">Max 5 device</span>
                    </div>
                </div>
                <form onsubmit="handleLogin(event)">
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-envelope me-2"></i>Email</label>
                        <input type="email" class="form-control" id="loginEmail" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-lock me-2"></i>Password</label>
                        <input type="password" class="form-control" id="loginPassword" required>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="rememberMe" checked>
                        <label class="form-check-label" for="rememberMe">
                            Ingat Saya (30 hari)
                        </label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="multiDevice" checked>
                        <label class="form-check-label" for="multiDevice">
                            Izinkan login dari device lain
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mb-3">
                        <i class="fas fa-sign-in-alt me-2"></i>Masuk
                    </button>
                    <div class="text-center">
                        <a href="#" onclick="showForgotPassword()" class="text-decoration-none">Lupa Password?</a>
                        <div class="mt-3">
                            Belum punya akun? <a href="#" onclick="showRegister()" class="text-decoration-none fw-bold">Daftar</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Register Form -->
        <div id="registerForm" class="auth-container" style="display: none;">
            <div class="auth-card">
                <div class="text-center mb-4">
                    <i class="fas fa-user-plus fa-3x text-success mb-3"></i>
                    <h2 class="app-name">Daftar Akun</h2>
                </div>
                <form onsubmit="handleRegister(event)">
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-user me-2"></i>Nama Lengkap</label>
                        <input type="text" class="form-control" id="regName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-envelope me-2"></i>Email</label>
                        <input type="email" class="form-control" id="regEmail" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-lock me-2"></i>Password</label>
                        <input type="password" class="form-control" id="regPassword" minlength="6" required>
                        <small class="text-muted">Minimal 6 karakter</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-lock me-2"></i>Konfirmasi Password</label>
                        <input type="password" class="form-control" id="regConfirmPassword" required>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="regMultiDevice" checked>
                        <label class="form-check-label" for="regMultiDevice">
                            Izinkan login dari device lain (maksimal 5 device)
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mb-3">
                        <i class="fas fa-user-plus me-2"></i>Daftar
                    </button>
                    <div class="text-center">
                        Sudah punya akun? <a href="#" onclick="showLogin()" class="text-decoration-none fw-bold">Masuk</a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Forgot Password Form -->
        <div id="forgotPasswordForm" class="auth-container" style="display: none;">
            <div class="auth-card">
                <div class="text-center mb-4">
                    <i class="fas fa-key fa-3x text-success mb-3"></i>
                    <h2 class="app-name">Lupa Password</h2>
                    <p class="text-muted">Masukkan email untuk reset password</p>
                </div>
                <form onsubmit="handleForgotPassword(event)">
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-envelope me-2"></i>Email</label>
                        <input type="email" class="form-control" id="forgotEmail" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mb-3">
                        <i class="fas fa-paper-plane me-2"></i>Kirim Link Reset
                    </button>
                    <div class="text-center">
                        <a href="#" onclick="showLogin()" class="text-decoration-none">Kembali ke Login</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h4 class="app-name mb-1">TaksMate</h4>
                <small class="text-muted" id="userWelcome">Selamat datang!</small>
                <div class="mt-2">
                    <small class="text-muted" id="deviceInfo">
                        <i class="fas fa-laptop me-1"></i>
                        <span id="currentDeviceType">Desktop</span>
                    </small>
                </div>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" class="active" onclick="showPage('dashboard')"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="#" onclick="showPage('tasks')"><i class="fas fa-tasks"></i> Daftar Tugas</a></li>
                <li><a href="#" onclick="showPage('members')"><i class="fas fa-users"></i> Anggota Tim</a></li>
                <li><a href="#" onclick="showPage('assignments')"><i class="fas fa-clipboard-check"></i> Pembagian Tugas</a></li>
                <li><a href="#" onclick="showPage('archive')"><i class="fas fa-archive"></i> Arsip Tugas</a></li>
                <li><a href="#" onclick="showPage('chat')"><i class="fas fa-comments"></i> Chat Tim</a></li>
                <li><a href="#" onclick="showPage('activity')"><i class="fas fa-history"></i> Riwayat Aktivitas</a></li>
                <li><a href="#" onclick="showPage('profile')"><i class="fas fa-user"></i> Profil Saya</a></li>
                <li><a href="#" onclick="showPage('sessions')"><i class="fas fa-laptop-house"></i> Device & Sessions</a></li>
                <!-- Admin Menu (Hanya tampil untuk admin) -->
                <li><a href="#" onclick="showAdminPanel()" id="adminMenuButton" style="display: none;">
                    <i class="fas fa-user-shield"></i> Admin Panel
                </a></li>
                <li><a href="#" onclick="handleLogout()"><i class="fas fa-sign-out-alt"></i> Keluar</a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard -->
            <div id="dashboardPage" class="page">
                <div class="content-card">
                    <div class="page-header">
                        <h3><i class="fas fa-home me-2"></i>Dashboard</h3>
                        <div class="device-badge" id="dashboardDeviceInfo"></div>
                    </div>
                    <div class="multi-device-info">
                        <h6><i class="fas fa-info-circle me-2"></i>Multi-Device Status</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-1"><i class="fas fa-laptop me-2"></i>Device saat ini: <strong id="currentDeviceName">Unknown</strong></p>
                                <p class="mb-1"><i class="fas fa-clock me-2"></i>Login sejak: <span id="sessionStartTime">-</span></p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-1"><i class="fas fa-mobile-alt me-2"></i>Active sessions: <strong id="activeSessionsCount">0</strong>/5</p>
                                <p class="mb-1"><i class="fas fa-shield-alt me-2"></i>Status: <span class="badge bg-success" id="sessionStatus">Active</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="card text-center border-0 shadow-sm">
                                <div class="card-body">
                                    <i class="fas fa-tasks fa-3x text-success mb-3"></i>
                                    <h4 id="totalTasks">0</h4>
                                    <p class="text-muted">Tugas Aktif</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card text-center border-0 shadow-sm">
                                <div class="card-body">
                                    <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                                    <h4 id="overdueTasks">0</h4>
                                    <p class="text-muted">Tugas Terlewat</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card text-center border-0 shadow-sm">
                                <div class="card-body">
                                    <i class="fas fa-archive fa-3x text-info mb-3"></i>
                                    <h4 id="archivedCount">0</h4>
                                    <p class="text-muted">Di Arsip</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card text-center border-0 shadow-sm">
                                <div class="card-body">
                                    <i class="fas fa-users fa-3x text-success mb-3"></i>
                                    <h4 id="totalMembers">0</h4>
                                    <p class="text-muted">Anggota Tim</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="card text-center border-0 shadow-sm">
                                <div class="card-body">
                                    <i class="fas fa-comments fa-3x text-success mb-3"></i>
                                    <h4 id="totalMessages">0</h4>
                                    <p class="text-muted">Pesan</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card text-center border-0 shadow-sm">
                                <div class="card-body">
                                    <i class="fas fa-clipboard-check fa-3x text-success mb-3"></i>
                                    <h4 id="totalAssignments">0</h4>
                                    <p class="text-muted">Penugasan</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card text-center border-0 shadow-sm">
                                <div class="card-body">
                                    <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                                    <h4 id="completedTasks">0</h4>
                                    <p class="text-muted">Tugas Selesai</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card text-center border-0 shadow-sm">
                                <div class="card-body">
                                    <i class="fas fa-history fa-3x text-info mb-3"></i>
                                    <h4 id="todayActivities">0</h4>
                                    <p class="text-muted">Aktivitas Hari Ini</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasks Page -->
            <div id="tasksPage" class="page" style="display: none;">
                <div class="content-card">
                    <div class="page-header">
                        <h3><i class="fas fa-tasks me-2"></i>Daftar Tugas</h3>
                    </div>
                    <form onsubmit="addTask(event)" class="mb-4">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="taskInput" placeholder="Nama tugas..." required>
                            </div>
                            <div class="col-md-4">
                                <input type="date" class="form-control" id="taskDeadline" required>
                            </div>
                            <div class="col-md-2">
                                <button type="submit" class="btn btn-success w-100">
                                    <i class="fas fa-plus me-2"></i>Tambah
                                </button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <select class="form-select" id="taskPriority">
                                    <option value="low">Prioritas Rendah</option>
                                    <option value="medium" selected>Prioritas Sedang</option>
                                    <option value="high">Prioritas Tinggi</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <select class="form-select" id="taskCategory">
                                    <option value="">Pilih Kategori</option>
                                    <option value="design">Desain</option>
                                    <option value="development">Pengembangan</option>
                                    <option value="marketing">Pemasaran</option>
                                    <option value="research">Riset</option>
                                    <option value="meeting">Rapat</option>
                                    <option value="documentation">Dokumentasi</option>
                                    <option value="testing">Testing</option>
                                </select>
                            </div>
                        </div>
                    </form>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama Tugas</th>
                                    <th>Prioritas</th>
                                    <th>Deadline</th>
                                    <th>Status</th>
                                    <th>Dibuat Oleh</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tasksList"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Members Page -->
            <div id="membersPage" class="page" style="display: none;">
                <div class="content-card">
                    <div class="page-header">
                        <h3><i class="fas fa-users me-2"></i>Anggota Tim</h3>
                    </div>
                    <form onsubmit="addMember(event)" class="mb-4">
                        <div class="row">
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="memberName" placeholder="Nama" required>
                            </div>
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="memberStrength" placeholder="Kelebihan">
                            </div>
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="memberWeakness" placeholder="Kekurangan">
                            </div>
                            <div class="col-md-3">
                                <button type="submit" class="btn btn-success w-100">
                                    <i class="fas fa-user-plus me-2"></i>Tambah
                                </button>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="memberSoftSkills" placeholder="Soft Skills (pisahkan dengan koma)">
                            </div>
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="memberHardSkills" placeholder="Hard Skills (pisahkan dengan koma)">
                            </div>
                        </div>
                    </form>
                    <div id="membersList"></div>
                </div>
            </div>

            <!-- Assignments Page -->
            <div id="assignmentsPage" class="page" style="display: none;">
                <div class="content-card">
                    <div class="page-header">
                        <h3><i class="fas fa-clipboard-check me-2"></i>Pembagian Tugas</h3>
                    </div>
                    <button class="btn btn-success mb-3" onclick="generateAssignments()">
                        <i class="fas fa-magic me-2"></i>Generate Pembagian Tugas
                    </button>
                    <div id="assignmentsList"></div>
                </div>
            </div>

            <!-- Archive Page -->
            <div id="archivePage" class="page" style="display: none;">
                <div class="content-card">
                    <div class="page-header">
                        <h3><i class="fas fa-archive me-2"></i>Arsip Tugas</h3>
                        <p class="text-muted mb-0">Tugas yang sudah terlewat atau selesai</p>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <select class="form-select" id="archiveFilter" onchange="filterArchivedTasks()">
                                <option value="all">Semua Tugas</option>
                                <option value="overdue">Terlewat</option>
                                <option value="completed">Selesai</option>
                                <option value="manual">Diarsip Manual</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="archiveSearch" placeholder="Cari tugas..." onkeyup="searchArchivedTasks()">
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-danger w-100" onclick="clearArchive()">
                                <i class="fas fa-trash me-2"></i>Kosongkan Arsip
                            </button>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Arsip berisi <span id="archiveCount">0</span> tugas. Tugas diarsip otomatis ketika terlewat atau bisa diarsip manual.
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama Tugas</th>
                                    <th>Kategori</th>
                                    <th>Status</th>
                                    <th>Deadline</th>
                                    <th>Alasan Arsip</th>
                                    <th>Tanggal Arsip</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="archivedTasksList"></tbody>
                        </table>
                    </div>
                    
                    <div class="mt-4">
                        <h5><i class="fas fa-chart-bar me-2"></i>Statistik Arsip</h5>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h3 id="overdueCount">0</h3>
                                        <p class="text-muted">Terlewat</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h3 id="completedCount">0</h3>
                                        <p class="text-muted">Selesai</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h3 id="thisMonthCount">0</h3>
                                        <p class="text-muted">Arsip Bulan Ini</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h3 id="oldestArchive">-</h3>
                                        <p class="text-muted">Arsip Tertua</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Page -->
            <div id="chatPage" class="page" style="display: none;">
                <div class="content-card">
                    <div class="page-header">
                        <h3><i class="fas fa-comments me-2"></i>Chat Tim</h3>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <select class="form-select" id="messageType" onchange="updateRecipientSelect()">
                                <option value="public">Pesan Umum</option>
                                <option value="private">Pesan Pribadi</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <select class="form-select" id="messageRecipient" style="display: none;">
                                <option value="">Pilih Penerima</option>
                            </select>
                        </div>
                    </div>
                    <div class="chat-container mb-3" id="chatContainer"></div>
                    <form onsubmit="sendMessage(event)">
                        <div class="input-group">
                            <input type="text" class="form-control" id="messageInput" placeholder="Ketik pesan..." required>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-paper-plane"></i> Kirim
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Activity History Page -->
            <div id="activityPage" class="page" style="display: none;">
                <div class="content-card">
                    <div class="page-header">
                        <h3><i class="fas fa-history me-2"></i>Riwayat Aktivitas</h3>
                        <p class="text-muted mb-0">Log semua aktivitas dalam tim</p>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="activity-stats">
                        <div class="stat-card">
                            <i class="fas fa-clock text-info"></i>
                            <h4 id="activityToday">0</h4>
                            <p>Hari Ini</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-tasks text-success"></i>
                            <h4 id="activityTasks">0</h4>
                            <p>Aktivitas Tugas</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-users text-warning"></i>
                            <h4 id="activityMembers">0</h4>
                            <p>Aktivitas Anggota</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-user text-primary"></i>
                            <h4 id="activityMy">0</h4>
                            <p>Aktivitas Saya</p>
                        </div>
                    </div>
                    
                    <!-- Filter Section -->
                    <div class="activity-filter">
                        <div class="row">
                            <div class="col-md-3 mb-2">
                                <select class="form-select" id="activityTypeFilter" onchange="filterActivities()">
                                    <option value="all">Semua Jenis</option>
                                    <option value="task">Tugas</option>
                                    <option value="member">Anggota</option>
                                    <option value="assignment">Penugasan</option>
                                    <option value="chat">Chat</option>
                                    <option value="system">System</option>
                                    <option value="archive">Arsip</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-2">
                                <select class="form-select" id="activityUserFilter" onchange="filterActivities()">
                                    <option value="all">Semua User</option>
                                    <option value="me">Hanya Saya</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-2">
                                <select class="form-select" id="activityTimeFilter" onchange="filterActivities()">
                                    <option value="all">Semua Waktu</option>
                                    <option value="today">Hari Ini</option>
                                    <option value="week">Minggu Ini</option>
                                    <option value="month">Bulan Ini</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-2">
                                <button class="btn btn-success w-100" onclick="exportActivities()">
                                    <i class="fas fa-download me-2"></i>Export
                                </button>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="activitySearch" 
                                       placeholder="Cari aktivitas..." onkeyup="searchActivities()">
                            </div>
                            <div class="col-md-6 text-end">
                                <button class="btn btn-danger" onclick="clearActivities()">
                                    <i class="fas fa-trash me-2"></i>Hapus Riwayat
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Activity Timeline -->
                    <div id="activitiesList" class="activity-timeline"></div>
                    
                    <!-- Empty State -->
                    <div id="emptyActivities" class="text-center py-5" style="display: none;">
                        <i class="fas fa-history fa-3x mb-3 text-muted"></i>
                        <h5>Belum ada aktivitas</h5>
                        <p class="text-muted">Aktivitas akan tercatat di sini</p>
                    </div>
                    
                    <!-- Load More Button -->
                    <div class="text-center mt-4" id="loadMoreContainer" style="display: none;">
                        <button class="btn btn-outline-success" onclick="loadMoreActivities()">
                            <i class="fas fa-arrow-down me-2"></i>Muat Lebih Banyak
                        </button>
                    </div>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profilePage" class="page" style="display: none;">
                <div class="content-card">
                    <div class="page-header">
                        <h3><i class="fas fa-user me-2"></i>Profil Saya</h3>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <form onsubmit="updateProfile(event)">
                                <div class="mb-3">
                                    <label class="form-label">Nama Lengkap</label>
                                    <input type="text" class="form-control" id="profileName" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="profileEmail" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Password Baru (Kosongkan jika tidak ingin mengubah)</label>
                                    <input type="password" class="form-control" id="profilePassword" minlength="6">
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="profileMultiDevice" checked>
                                    <label class="form-check-label" for="profileMultiDevice">
                                        Izinkan login dari device lain (maksimal 5 device)
                                    </label>
                                </div>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save me-2"></i>Simpan Perubahan
                                </button>
                            </form>
                        </div>
                        <div class="col-md-6">
                            <div class="multi-device-info">
                                <h6><i class="fas fa-laptop-house me-2"></i>Multi-Device Settings</h6>
                                <p class="mb-2"><i class="fas fa-info-circle me-2"></i>Saat ini login dari: <strong id="currentDeviceCount">0</strong> device</p>
                                <p class="mb-2"><i class="fas fa-shield-alt me-2"></i>Device limit: <strong>5</strong> device aktif</p>
                                <p class="mb-2"><i class="fas fa-clock me-2"></i>Session timeout: <strong>30 hari</strong></p>
                                <button class="btn btn-sm btn-outline-primary mt-2" onclick="showPage('sessions')">
                                    <i class="fas fa-cog me-1"></i>Kelola Sessions
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sessions Page -->
            <div id="sessionsPage" class="page" style="display: none;">
                <div class="content-card">
                    <div class="page-header">
                        <h3><i class="fas fa-laptop-house me-2"></i>Device & Sessions</h3>
                        <p class="text-muted mb-0">Kelola login Anda dari berbagai device</p>
                    </div>
                    
                    <div class="multi-device-info mb-4">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="text-center">
                                    <i class="fas fa-laptop fa-2x text-primary mb-2"></i>
                                    <h4 id="activeDevicesCount">0</h4>
                                    <p class="mb-0">Device Aktif</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <i class="fas fa-clock fa-2x text-warning mb-2"></i>
                                    <h4 id="totalSessionsCount">0</h4>
                                    <p class="mb-0">Total Sessions</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <i class="fas fa-shield-alt fa-2x text-success mb-2"></i>
                                    <h4>5</h4>
                                    <p class="mb-0">Device Limit</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Anda bisa login maksimal dari <strong>5 device</strong> secara bersamaan. Sessions akan expired setelah <strong>30 hari</strong> tidak aktif.
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Active Sessions</h5>
                        <div>
                            <button class="btn btn-sm btn-outline-danger me-2" onclick="logoutAllOtherDevices()">
                                <i class="fas fa-sign-out-alt me-1"></i>Logout Semua Device Lain
                            </button>
                            <button class="btn btn-sm btn-outline-primary" onclick="refreshSessions()">
                                <i class="fas fa-sync-alt me-1"></i>Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div id="sessionsList">
                        <!-- Sessions will be loaded here -->
                    </div>
                    
                    <div class="mt-4">
                        <h5><i class="fas fa-question-circle me-2"></i>Tips Keamanan</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h6><i class="fas fa-check-circle text-success me-2"></i>Yang harus dilakukan:</h6>
                                        <ul class="mb-0">
                                            <li><small>Logout dari device yang tidak dikenal</small></li>
                                            <li><small>Ganti password secara berkala</small></li>
                                            <li><small>Gunakan device yang terpercaya</small></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h6><i class="fas fa-times-circle text-danger me-2"></i>Yang harus dihindari:</h6>
                                        <ul class="mb-0">
                                            <li><small>Login dari device publik</small></li>
                                            <li><small>Biarkan session tanpa logout</small></li>
                                            <li><small>Bagikan session dengan orang lain</small></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div class="modal fade delete-modal" id="adminModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-user-shield me-2"></i>Admin Panel - Kelola Anggota
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="stat-card-small">
                                <i class="fas fa-users text-primary"></i>
                                <h4 id="adminTotalUsers">0</h4>
                                <p>Total Anggota</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card-small">
                                <i class="fas fa-crown text-warning"></i>
                                <h4 id="adminTotalAdmins">0</h4>
                                <p>Admin</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card-small">
                                <i class="fas fa-user-check text-success"></i>
                                <h4 id="adminActiveUsers">0</h4>
                                <p>Aktif</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card-small">
                                <i class="fas fa-clock text-info"></i>
                                <h4 id="adminInactiveUsers">0</h4>
                                <p>Nonaktif</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Search and Filters -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="adminSearch" 
                                   placeholder="Cari anggota..." onkeyup="filterAdminUsers()">
                        </div>
                        <div class="col-md-4">
                            <select class="form-select" id="adminFilterRole" onchange="filterAdminUsers()">
                                <option value="all">Semua Role</option>
                                <option value="admin">Admin</option>
                                <option value="member">Anggota</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select" id="adminFilterStatus" onchange="filterAdminUsers()">
                                <option value="all">Semua Status</option>
                                <option value="active">Aktif</option>
                                <option value="inactive">Nonaktif</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Users Table -->
                    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-hover admin-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Nama</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Bergabung</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="adminUsersTable">
                                <!-- Data akan dimuat di sini -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Empty State -->
                    <div id="adminEmptyState" class="text-center py-4" style="display: none;">
                        <i class="fas fa-users-slash fa-3x text-muted mb-3"></i>
                        <h5>Tidak ada anggota</h5>
                        <p class="text-muted">Belum ada anggota yang terdaftar</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Tutup
                    </button>
                    <button type="button" class="btn btn-primary" onclick="exportAdminData()">
                        <i class="fas fa-download me-2"></i>Export Data
                    </button>
                    <button type="button" class="btn btn-danger" onclick="clearAllMembers()">
                        <i class="fas fa-trash-alt me-2"></i>Reset Semua
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Member Modal -->
    <div class="modal fade delete-modal" id="deleteMemberModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i>Konfirmasi Penghapusan
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-user-slash fa-4x text-danger mb-4"></i>
                    <h4 class="mb-3">Hapus Anggota?</h4>
                    <p id="deleteMemberName" class="h5"></p>
                    <p id="deleteMemberEmail" class="text-muted"></p>
                    
                    <div class="alert alert-warning mt-4">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Perhatian!</strong> Tindakan ini akan:
                        <ul class="mb-0 mt-2">
                            <li>Menghapus anggota dari tim</li>
                            <li>Menghapus semua tugas yang ditugaskan</li>
                            <li>Menghapus semua pesan dari anggota</li>
                            <li>Membatalkan semua penugasan terkait</li>
                        </ul>
                    </div>
                    
                    <div class="form-check mt-4 text-start">
                        <input class="form-check-input" type="checkbox" id="confirmDeleteCheck">
                        <label class="form-check-label" for="confirmDeleteCheck">
                            Saya mengerti dan ingin melanjutkan
                        </label>
                    </div>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Batal
                    </button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteMemberBtn" disabled>
                        <i class="fas fa-trash me-2"></i>Ya, Hapus Permanen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Logout All Modal -->
    <div class="modal fade" id="logoutAllModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i>Konfirmasi Logout
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-sign-out-alt fa-4x text-warning mb-4"></i>
                    <h4 class="mb-3">Logout dari Semua Device Lain?</h4>
                    <p>Anda akan logout dari semua device lain kecuali device ini.</p>
                    
                    <div class="alert alert-info mt-4">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Informasi:</strong> Device lain akan otomatis logout saat membuka aplikasi.
                    </div>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Batal
                    </button>
                    <button type="button" class="btn btn-warning" onclick="confirmLogoutAllDevices()">
                        <i class="fas fa-sign-out-alt me-2"></i>Ya, Logout Semua
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize
        let currentUser = null;
        let currentSession = null;
        let users = JSON.parse(localStorage.getItem('tasksmate_users')) || [];
        let tasks = JSON.parse(localStorage.getItem('tasksmate_tasks')) || [];
        let members = JSON.parse(localStorage.getItem('tasksmate_members')) || [];
        let messages = JSON.parse(localStorage.getItem('tasksmate_messages')) || [];
        let assignments = JSON.parse(localStorage.getItem('tasksmate_assignments')) || [];
        let archivedTasks = JSON.parse(localStorage.getItem('tasksmate_archived_tasks')) || [];
        let activities = JSON.parse(localStorage.getItem('tasksmate_activities')) || [];
        let sessions = JSON.parse(localStorage.getItem('tasksmate_sessions')) || [];
        
        // Admin emails
        let adminEmails = ['admin@tasksmate.com', 'rizqimaulana0406@gmail.com'];
        
        // Activity types
        const ACTIVITY_TYPES = {
            TASK_CREATED: 'task_created',
            TASK_UPDATED: 'task_updated',
            TASK_DELETED: 'task_deleted',
            TASK_STATUS_CHANGED: 'task_status_changed',
            TASK_ARCHIVED: 'task_archived',
            MEMBER_ADDED: 'member_added',
            MEMBER_DELETED: 'member_deleted',
            ASSIGNMENT_GENERATED: 'assignment_generated',
            CHAT_MESSAGE: 'chat_message',
            SYSTEM: 'system',
            LOGIN: 'login',
            LOGOUT: 'logout',
            PROFILE_UPDATED: 'profile_updated',
            SESSION_CREATED: 'session_created',
            SESSION_EXPIRED: 'session_expired',
            SESSION_REMOVED: 'session_removed',
            MULTI_DEVICE_LOGIN: 'multi_device_login',
            DEVICE_LIMIT_EXCEEDED: 'device_limit_exceeded'
        };
        
        // Device detection
        function detectDeviceType() {
            const userAgent = navigator.userAgent.toLowerCase();
            const screenWidth = window.screen.width;
            
            if (/mobile|android|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent)) {
                if (screenWidth < 768) {
                    return 'mobile';
                } else {
                    return 'tablet';
                }
            } else {
                return 'desktop';
            }
        }
        
        function getDeviceName() {
            const deviceType = detectDeviceType();
            const browser = getBrowserName();
            const os = getOSName();
            
            return `${deviceType.charAt(0).toUpperCase() + deviceType.slice(1)} (${browser} on ${os})`;
        }
        
        function getBrowserName() {
            const userAgent = navigator.userAgent;
            if (userAgent.includes("Chrome") && !userAgent.includes("Edg") && !userAgent.includes("OPR")) return "Chrome";
            if (userAgent.includes("Firefox")) return "Firefox";
            if (userAgent.includes("Safari") && !userAgent.includes("Chrome")) return "Safari";
            if (userAgent.includes("Edg")) return "Edge";
            if (userAgent.includes("OPR")) return "Opera";
            return "Browser";
        }
        
        function getOSName() {
            const userAgent = navigator.userAgent;
            if (userAgent.includes("Windows")) return "Windows";
            if (userAgent.includes("Mac")) return "MacOS";
            if (userAgent.includes("Linux")) return "Linux";
            if (userAgent.includes("Android")) return "Android";
            if (userAgent.includes("iOS") || userAgent.includes("iPhone") || userAgent.includes("iPad")) return "iOS";
            return "Unknown OS";
        }
        
        function getDeviceIcon(deviceType) {
            switch(deviceType) {
                case 'mobile': return 'fas fa-mobile-alt';
                case 'tablet': return 'fas fa-tablet-alt';
                case 'desktop': return 'fas fa-laptop';
                default: return 'fas fa-desktop';
            }
        }
        
        function getDeviceBadgeClass(deviceType) {
            switch(deviceType) {
                case 'mobile': return 'device-mobile';
                case 'tablet': return 'device-tablet';
                case 'desktop': return 'device-desktop';
                default: return 'device-unknown';
            }
        }
        
        // Session management
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        function createSession(userId, rememberMe = true, allowMultiDevice = true) {
            const sessionId = generateSessionId();
            const deviceType = detectDeviceType();
            const now = new Date();
            const expiryDate = new Date();
            expiryDate.setDate(now.getDate() + (rememberMe ? 30 : 1)); // 30 hari atau 1 hari
            
            const session = {
                id: sessionId,
                userId: userId,
                deviceType: deviceType,
                deviceName: getDeviceName(),
                browser: getBrowserName(),
                os: getOSName(),
                ipAddress: '127.0.0.1', // Simulasi IP
                userAgent: navigator.userAgent.substring(0, 200),
                createdAt: now.toISOString(),
                lastActive: now.toISOString(),
                expiresAt: expiryDate.toISOString(),
                isActive: true,
                isCurrent: true,
                allowMultiDevice: allowMultiDevice
            };
            
            // Cek apakah user sudah mencapai limit device
            if (allowMultiDevice) {
                const userSessions = sessions.filter(s => 
                    s.userId === userId && 
                    s.isActive && 
                    s.allowMultiDevice &&
                    new Date(s.expiresAt) > now
                );
                
                if (userSessions.length >= 5) {
                    // Hapus session terlama
                    const oldestSession = userSessions.reduce((oldest, current) => 
                        new Date(current.createdAt) < new Date(oldest.createdAt) ? current : oldest
                    );
                    
                    oldestSession.isActive = false;
                    logActivity(ACTIVITY_TYPES.DEVICE_LIMIT_EXCEEDED, 
                        `Device limit exceeded, removing oldest session from ${oldestSession.deviceName}`,
                        { removedDevice: oldestSession.deviceName }
                    );
                }
            }
            
            sessions.push(session);
            localStorage.setItem('tasksmate_sessions', JSON.stringify(sessions));
            
            return session;
        }
        
        function updateSessionActivity(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (session) {
                session.lastActive = new Date().toISOString();
                localStorage.setItem('tasksmate_sessions', JSON.stringify(sessions));
            }
        }
        
        function cleanupExpiredSessions() {
            const now = new Date();
            let cleanedCount = 0;
            
            sessions.forEach(session => {
                if (new Date(session.expiresAt) < now && session.isActive) {
                    session.isActive = false;
                    cleanedCount++;
                    
                    logActivity(ACTIVITY_TYPES.SESSION_EXPIRED, 
                        `Session expired for device: ${session.deviceName}`,
                        { deviceName: session.deviceName }
                    );
                }
            });
            
            if (cleanedCount > 0) {
                localStorage.setItem('tasksmate_sessions', JSON.stringify(sessions));
            }
            
            return cleanedCount;
        }
        
        function getCurrentUserSessions() {
            if (!currentUser) return [];
            const now = new Date();
            
            return sessions.filter(s => 
                s.userId === currentUser.id && 
                s.isActive && 
                new Date(s.expiresAt) > now
            ).sort((a, b) => new Date(b.lastActive) - new Date(a.lastActive));
        }
        
        function logoutSession(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (session) {
                session.isActive = false;
                localStorage.setItem('tasksmate_sessions', JSON.stringify(sessions));
                
                logActivity(ACTIVITY_TYPES.SESSION_REMOVED, 
                    `Logged out session from ${session.deviceName}`,
                    { deviceName: session.deviceName }
                );
                
                return true;
            }
            return false;
        }
        
        function logoutAllOtherSessions() {
            if (!currentSession) return 0;
            
            let loggedOutCount = 0;
            const now = new Date();
            
            sessions.forEach(session => {
                if (session.userId === currentUser.id && 
                    session.id !== currentSession.id && 
                    session.isActive &&
                    new Date(session.expiresAt) > now) {
                    
                    session.isActive = false;
                    loggedOutCount++;
                    
                    logActivity(ACTIVITY_TYPES.SESSION_REMOVED, 
                        `Logged out other session from ${session.deviceName}`,
                        { deviceName: session.deviceName }
                    );
                }
            });
            
            if (loggedOutCount > 0) {
                localStorage.setItem('tasksmate_sessions', JSON.stringify(sessions));
            }
            
            return loggedOutCount;
        }
        
        // Update device info in UI
        function updateDeviceInfo() {
            if (!currentSession) return;
            
            const deviceType = currentSession.deviceType;
            const deviceIcon = getDeviceIcon(deviceType);
            const deviceBadgeClass = getDeviceBadgeClass(deviceType);
            
            // Update sidebar
            document.getElementById('currentDeviceType').textContent = 
                deviceType.charAt(0).toUpperCase() + deviceType.slice(1);
            
            // Update dashboard
            document.getElementById('dashboardDeviceInfo').innerHTML = `
                <span class="device-badge ${deviceBadgeClass}">
                    <i class="${deviceIcon} me-1"></i>${deviceType}
                </span>
            `;
            
            // Update device name
            document.getElementById('currentDeviceName').textContent = currentSession.deviceName;
            
            // Update session start time
            const startTime = new Date(currentSession.createdAt);
            document.getElementById('sessionStartTime').textContent = 
                startTime.toLocaleString('id-ID');
            
            // Update active sessions count
            const activeSessions = getCurrentUserSessions();
            document.getElementById('activeSessionsCount').textContent = activeSessions.length;
            document.getElementById('currentDeviceCount').textContent = activeSessions.length;
        }
        
        // Load sessions page
        function loadSessionsPage() {
            const container = document.getElementById('sessionsList');
            const activeSessions = getCurrentUserSessions();
            const allSessions = sessions.filter(s => s.userId === currentUser.id);
            
            document.getElementById('activeDevicesCount').textContent = activeSessions.length;
            document.getElementById('totalSessionsCount').textContent = allSessions.length;
            
            if (activeSessions.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-laptop-house fa-3x text-muted mb-3"></i>
                        <h5>Tidak ada session aktif</h5>
                        <p class="text-muted">Anda belum login dari device manapun</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            const now = new Date();
            
            activeSessions.forEach(session => {
                const isCurrent = session.id === currentSession.id;
                const deviceIcon = getDeviceIcon(session.deviceType);
                const createdTime = new Date(session.createdAt);
                const lastActive = new Date(session.lastActive);
                const expiresAt = new Date(session.expiresAt);
                
                const timeDiff = Math.floor((now - lastActive) / (1000 * 60)); // minutes
                let lastActiveText = '';
                
                if (timeDiff < 1) {
                    lastActiveText = 'Baru saja';
                } else if (timeDiff < 60) {
                    lastActiveText = `${timeDiff} menit lalu`;
                } else if (timeDiff < 1440) {
                    lastActiveText = `${Math.floor(timeDiff / 60)} jam lalu`;
                } else {
                    lastActiveText = `${Math.floor(timeDiff / 1440)} hari lalu`;
                }
                
                html += `
                    <div class="session-item ${isCurrent ? 'current' : ''}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="d-flex align-items-center">
                                <div class="device-icon">
                                    <i class="${deviceIcon}"></i>
                                </div>
                                <div>
                                    <h6 class="mb-1">
                                        ${session.deviceName}
                                        ${isCurrent ? '<span class="badge bg-primary ms-2">Device Saat Ini</span>' : ''}
                                    </h6>
                                    <p class="mb-1 text-muted">
                                        <small>
                                            <i class="fas fa-clock me-1"></i>Login: ${createdTime.toLocaleString('id-ID')}
                                        </small>
                                    </p>
                                    <p class="mb-1 text-muted">
                                        <small>
                                            <i class="fas fa-sync-alt me-1"></i>Aktif terakhir: ${lastActiveText}
                                        </small>
                                    </p>
                                    <p class="mb-0">
                                        <span class="session-status ${session.isActive ? 'session-active' : 'session-expired'}">
                                            ${session.isActive ? 'Aktif' : 'Expired'}
                                        </span>
                                        <span class="ms-2 text-muted">
                                            <small><i class="fas fa-calendar me-1"></i>Expires: ${expiresAt.toLocaleDateString('id-ID')}</small>
                                        </span>
                                    </p>
                                </div>
                            </div>
                            <div>
                                ${!isCurrent ? `
                                    <button class="btn btn-sm btn-outline-danger" onclick="logoutSingleSession('${session.id}')">
                                        <i class="fas fa-sign-out-alt"></i> Logout
                                    </button>
                                ` : `
                                    <button class="btn btn-sm btn-outline-secondary" disabled>
                                        <i class="fas fa-check"></i> Aktif
                                    </button>
                                `}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Logout single session
        function logoutSingleSession(sessionId) {
            if (confirm('Logout dari device ini?')) {
                if (logoutSession(sessionId)) {
                    alert('Device berhasil dilogout!');
                    loadSessionsPage();
                }
            }
        }
        
        // Logout all other devices
        function logoutAllOtherDevices() {
            const modal = new bootstrap.Modal(document.getElementById('logoutAllModal'));
            modal.show();
        }
        
        function confirmLogoutAllDevices() {
            const loggedOutCount = logoutAllOtherSessions();
            alert(` Berhasil logout dari ${loggedOutCount} device lain!`);
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('logoutAllModal'));
            modal.hide();
            
            loadSessionsPage();
            updateDeviceInfo();
        }
        
        function refreshSessions() {
            cleanupExpiredSessions();
            loadSessionsPage();
            updateDeviceInfo();
            alert('Sessions refreshed!');
        }
        
        // Simple hash function
        function hashPassword(password) {
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString();
        }

        // Log activity function
        function logActivity(type, details, data = null) {
            const activity = {
                id: Date.now(),
                type: type,
                user: currentUser ? currentUser.name : 'System',
                userId: currentUser ? currentUser.id : null,
                details: details,
                data: data,
                timestamp: new Date().toISOString(),
                ipAddress: '127.0.0.1',
                browser: navigator.userAgent.substring(0, 50)
            };
            
            activities.unshift(activity);
            localStorage.setItem('tasksmate_activities', JSON.stringify(activities));
            
            // Update dashboard if visible
            updateDashboard();
        }

        // Check session on load
        window.onload = function() {
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('hidden');
                checkSession();
                
                // Cleanup expired sessions setiap kali app load
                cleanupExpiredSessions();
                
                // Update session activity setiap 5 menit
                setInterval(() => {
                    if (currentSession) {
                        updateSessionActivity(currentSession.id);
                    }
                }, 5 * 60 * 1000);
                
            }, 1000);
        }

        function checkSession() {
            const sessionId = localStorage.getItem('tasksmate_current_session');
            if (sessionId) {
                const session = sessions.find(s => s.id === sessionId);
                const now = new Date();
                
                if (session && session.isActive && new Date(session.expiresAt) > now) {
                    // Session valid, cari user
                    const user = users.find(u => u.id === session.userId);
                    if (user) {
                        currentUser = user;
                        currentSession = session;
                        
                        // Update session activity
                        updateSessionActivity(sessionId);
                        
                        showApp();
                        logActivity(ACTIVITY_TYPES.LOGIN, 'User auto-login from session');
                        checkOverdueTasks();
                        updateDeviceInfo();
                        return;
                    }
                } else {
                    // Session expired, hapus
                    localStorage.removeItem('tasksmate_current_session');
                }
            }
            
            showAuth();
        }

        function showAuth() {
            document.getElementById('authContainer').style.display = 'block';
            document.getElementById('appContainer').style.display = 'none';
            showLogin();
        }

        function showApp() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            document.getElementById('userWelcome').textContent = `Halo, ${currentUser.name}!`;
            
            // Show admin menu if user is admin
            const adminMenu = document.getElementById('adminMenuButton');
            if (currentUser.isAdmin || adminEmails.includes(currentUser.email.toLowerCase())) {
                adminMenu.style.display = 'block';
            }
            
            loadProfileData();
            updateDashboard();
            loadTasks();
            loadMembers();
            loadMessages();
            updateRecipientSelect();
            updateDeviceInfo();
            
            // Set interval untuk update device info
            setInterval(updateDeviceInfo, 60000);
        }

        function showLogin() {
            document.getElementById('loginForm').style.display = 'flex';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'none';
        }

        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'flex';
            document.getElementById('forgotPasswordForm').style.display = 'none';
        }

        function showForgotPassword() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'flex';
        }

        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            const allowMultiDevice = document.getElementById('regMultiDevice').checked;

            if (password !== confirmPassword) {
                alert('Password tidak cocok!');
                return;
            }

            if (users.find(u => u.email === email)) {
                alert('Email sudah terdaftar!');
                return;
            }

            const isAdmin = adminEmails.includes(email.toLowerCase());
            const now = new Date().toISOString();

            const user = {
                id: Date.now(),
                name: name,
                email: email,
                password: hashPassword(password),
                isAdmin: isAdmin,
                isActive: true,
                lastLogin: now,
                createdAt: now,
                role: isAdmin ? 'admin' : 'member',
                permissions: isAdmin ? ['admin', 'delete', 'edit', 'view'] : ['view'],
                loginCount: 0,
                allowMultiDevice: allowMultiDevice,
                maxDevices: 5
            };

            users.push(user);
            localStorage.setItem('tasksmate_users', JSON.stringify(users));
            
            logActivity(ACTIVITY_TYPES.MEMBER_ADDED, 
                `User mendaftar: "${name}" ${isAdmin ? '(sebagai admin)' : ''}`, 
                { userId: user.id, userName: name, isAdmin: isAdmin, allowMultiDevice: allowMultiDevice }
            );
            
            alert(isAdmin ? ' Registrasi berhasil! Anda terdaftar sebagai Admin.' : ' Registrasi berhasil! Silakan login.');
            showLogin();
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const remember = document.getElementById('rememberMe').checked;
            const allowMultiDevice = document.getElementById('multiDevice').checked;

            const user = users.find(u => u.email === email && u.password === hashPassword(password));

            if (user) {
                // Cek jika user tidak mengizinkan multi device dan sudah ada session aktif
                if (!allowMultiDevice && user.allowMultiDevice === false) {
                    const activeSessions = getCurrentUserSessions(user.id);
                    if (activeSessions.length > 0) {
                        if (!confirm('Akun Anda sudah login dari device lain. Ingin logout dari device lain dan login di device ini?')) {
                            return;
                        }
                        // Logout semua session lain
                        logoutAllOtherSessions();
                    }
                }
                
                // Update user last login
                user.lastLogin = new Date().toISOString();
                user.loginCount = (user.loginCount || 0) + 1;
                user.isActive = true;
                
                // Update in users array
                const userIndex = users.findIndex(u => u.id === user.id);
                if (userIndex !== -1) {
                    users[userIndex] = user;
                    localStorage.setItem('tasksmate_users', JSON.stringify(users));
                }
                
                currentUser = user;
                
                // Create new session
                const session = createSession(user.id, remember, allowMultiDevice);
                currentSession = session;
                
                // Save session ID
                localStorage.setItem('tasksmate_current_session', session.id);
                
                logActivity(ACTIVITY_TYPES.LOGIN, 'User login to the system', 
                    { deviceType: session.deviceType, allowMultiDevice: allowMultiDevice });
                
                if (allowMultiDevice) {
                    logActivity(ACTIVITY_TYPES.MULTI_DEVICE_LOGIN, 
                        `User logged in from ${session.deviceName}`, 
                        { deviceName: session.deviceName, deviceType: session.deviceType });
                }
                
                showApp();
            } else {
                alert('Email atau password salah!');
            }
        }

        function handleForgotPassword(e) {
            e.preventDefault();
            const email = document.getElementById('forgotEmail').value;
            const user = users.find(u => u.email === email);

            if (user) {
                // Logout semua session user ini untuk keamanan
                sessions.forEach(session => {
                    if (session.userId === user.id && session.isActive) {
                        session.isActive = false;
                    }
                });
                localStorage.setItem('tasksmate_sessions', JSON.stringify(sessions));
                
                alert('Link reset password telah dikirim ke email Anda! Semua session aktif telah dihapus untuk keamanan.');
                showLogin();
            } else {
                alert('Email tidak ditemukan!');
            }
        }

        function handleLogout() {
            if (confirm('Yakin ingin keluar?')) {
                // Set user as inactive
                if (currentUser) {
                    const userIndex = users.findIndex(u => u.id === currentUser.id);
                    if (userIndex !== -1) {
                        users[userIndex].isActive = false;
                        localStorage.setItem('tasksmate_users', JSON.stringify(users));
                    }
                }
                
                // Logout session saat ini
                if (currentSession) {
                    logoutSession(currentSession.id);
                }
                
                logActivity(ACTIVITY_TYPES.LOGOUT, 'User logged out from the system');
                localStorage.removeItem('tasksmate_current_session');
                currentUser = null;
                currentSession = null;
                showAuth();
            }
        }

        function loadProfileData() {
            document.getElementById('profileName').value = currentUser.name;
            document.getElementById('profileEmail').value = currentUser.email;
            document.getElementById('profileMultiDevice').checked = currentUser.allowMultiDevice !== false;
        }

        function updateProfile(e) {
            e.preventDefault();
            const name = document.getElementById('profileName').value;
            const email = document.getElementById('profileEmail').value;
            const password = document.getElementById('profilePassword').value;
            const allowMultiDevice = document.getElementById('profileMultiDevice').checked;

            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].name = name;
                users[userIndex].email = email;
                users[userIndex].allowMultiDevice = allowMultiDevice;
                
                if (password) {
                    users[userIndex].password = hashPassword(password);
                    // Logout semua session lain jika password diubah
                    logoutAllOtherSessions();
                }
                
                currentUser = users[userIndex];
                localStorage.setItem('tasksmate_users', JSON.stringify(users));
                localStorage.setItem('tasksmate_session', JSON.stringify(currentUser));
                
                logActivity(ACTIVITY_TYPES.PROFILE_UPDATED, 'Updated profile information', 
                    { allowMultiDevice: allowMultiDevice });
                
                document.getElementById('userWelcome').textContent = `Halo, ${currentUser.name}!`;
                alert('Profil berhasil diperbarui!' + (password ? ' Semua session lain telah dilogout.' : ''));
            }
        }

        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.querySelectorAll('.sidebar-menu a').forEach(a => a.classList.remove('active'));
            
            if (page === 'dashboard') {
                document.getElementById('dashboardPage').style.display = 'block';
                updateDashboard();
                updateDeviceInfo();
                document.querySelector('.sidebar-menu a[onclick*="dashboard"]').classList.add('active');
            } else if (page === 'tasks') {
                document.getElementById('tasksPage').style.display = 'block';
                loadTasks();
                const nextWeek = new Date();
                nextWeek.setDate(nextWeek.getDate() + 7);
                document.getElementById('taskDeadline').value = nextWeek.toISOString().split('T')[0];
                document.querySelector('.sidebar-menu a[onclick*="tasks"]').classList.add('active');
            } else if (page === 'members') {
                document.getElementById('membersPage').style.display = 'block';
                loadMembers();
                document.querySelector('.sidebar-menu a[onclick*="members"]').classList.add('active');
            } else if (page === 'assignments') {
                document.getElementById('assignmentsPage').style.display = 'block';
                loadAssignments();
                document.querySelector('.sidebar-menu a[onclick*="assignments"]').classList.add('active');
            } else if (page === 'archive') {
                document.getElementById('archivePage').style.display = 'block';
                loadArchivedTasks();
                updateArchiveStats();
                document.querySelector('.sidebar-menu a[onclick*="archive"]').classList.add('active');
            } else if (page === 'chat') {
                document.getElementById('chatPage').style.display = 'block';
                loadMessages();
                document.querySelector('.sidebar-menu a[onclick*="chat"]').classList.add('active');
            } else if (page === 'activity') {
                document.getElementById('activityPage').style.display = 'block';
                loadActivities();
                updateActivityStats();
                document.querySelector('.sidebar-menu a[onclick*="activity"]').classList.add('active');
            } else if (page === 'profile') {
                document.getElementById('profilePage').style.display = 'block';
                loadProfileData();
                document.querySelector('.sidebar-menu a[onclick*="profile"]').classList.add('active');
            } else if (page === 'sessions') {
                document.getElementById('sessionsPage').style.display = 'block';
                loadSessionsPage();
                document.querySelector('.sidebar-menu a[onclick*="sessions"]').classList.add('active');
            }
        }

        function updateDashboard() {
            const activeTasks = tasks.filter(t => !t.isArchived);
            const overdueTasks = activeTasks.filter(t => {
                const today = new Date();
                const deadline = new Date(t.deadline);
                return deadline < today;
            });
            
            const completedTasks = activeTasks.filter(t => t.status === 'completed').length;
            
            document.getElementById('totalTasks').textContent = activeTasks.length;
            document.getElementById('overdueTasks').textContent = overdueTasks.length;
            document.getElementById('archivedCount').textContent = archivedTasks.length;
            document.getElementById('totalMembers').textContent = members.length;
            document.getElementById('totalMessages').textContent = messages.length;
            document.getElementById('totalAssignments').textContent = assignments.length;
            document.getElementById('completedTasks').textContent = completedTasks;
            
            // Update activity count for dashboard
            const today = new Date().toDateString();
            const todayActivities = activities.filter(act => 
                new Date(act.timestamp).toDateString() === today
            ).length;
            document.getElementById('todayActivities').textContent = todayActivities;
            
            checkOverdueTasks();
        }

        // ... [FUNGSI-FUNGSI LAINNYA TETAP SAMA SEPERTI SEBELUMNYA] ...
        // Semua fungsi lainnya (addTask, loadTasks, updateTaskStatus, dll) tetap sama
        // Saya hanya menunjukkan bagian yang diubah untuk multi-device
        // Untuk menghemat ruang, saya tidak menulis ulang semua fungsi

        // Fungsi-fungsi yang sudah ada sebelumnya tetap sama
        // Hanya tambahkan panggilan ke updateDeviceInfo() di showApp()
        // dan tambahkan halaman sessions

        // Untuk fungsi-fungsi yang lain seperti addTask, loadTasks, dll
        // tetap sama seperti kode sebelumnya

        // Toggle sidebar function
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // Initialize system activity
        setTimeout(() => {
            if (currentUser) {
                logActivity(ACTIVITY_TYPES.SYSTEM, 'Aplikasi dimuat dengan sukses');
            }
        }, 1000);

        // Check overdue tasks periodically
        setInterval(checkOverdueTasks, 300000);
    </script>
</body>
</html>